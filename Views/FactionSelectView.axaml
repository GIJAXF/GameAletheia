<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:GameAletheiaCross.ViewModels"
             x:Class="GameAletheiaCross.Views.FactionSelectView"
             x:DataType="vm:FactionSelectViewModel">

    <Grid>
        <!-- Imagen de fondo -->
        <Image x:Name="BackgroundImage"
               Source="{Binding BackgroundImage}"
               Stretch="UniformToFill"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"/>
        
        <!-- Overlay oscuro para mejorar legibilidad -->
        <Border Background="#000000AA" />
        
        <!-- Contenido -->
        <Grid IsVisible="{Binding !ShowIntroduction}">
            <StackPanel Margin="40"
                        Spacing="20"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">

                <TextBlock Text="SELECCIONA TU FACCIÓN"
                           FontSize="32"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Foreground="#00FF88"/>

                <TextBlock Text="Tu elección determinará tu camino en Aletheia"
                           FontSize="14"
                           HorizontalAlignment="Center"
                           Foreground="#CCCCCC"
                           Margin="0,0,0,20"/>

                <!-- Grid de facciones -->
                <ItemsControl ItemsSource="{Binding Factions}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Width="250"
                                    Height="100"
                                    Margin="15"
                                    Command="{Binding $parent[ItemsControl].DataContext.SelectFactionCommand}"
                                    CommandParameter="{Binding .}"
                                    Background="#1a1a2e"
                                    BorderBrush="#00D9FF"
                                    BorderThickness="2"
                                    CornerRadius="8"
                                    Padding="15">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="{Binding Name}"
                                             FontSize="18"
                                             FontWeight="Bold"
                                             Foreground="#00FF88"
                                             TextAlignment="Center"/>
                                    <TextBlock Text="{Binding Leader}"
                                             FontSize="11"
                                             Foreground="#AAAAAA"
                                             TextAlignment="Center"
                                             TextWrapping="Wrap"/>
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel HorizontalAlignment="Center" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <Button Content="← Volver"
                        Width="200"
                        Margin="0,20,0,0"
                        Command="{Binding BackCommand}"
                        HorizontalAlignment="Center"
                        Background="#533483"
                        Foreground="White"
                        FontWeight="Bold"/>
            </StackPanel>
        </Grid>
        
        <!-- Pantalla de introducción de facción -->
        <Grid IsVisible="{Binding ShowIntroduction}">
            <Border Background="#000000DD" />
            
            <Border Background="#0a0a15"
                    BorderBrush="{Binding SelectedFaction.ThemeColor}"
                    BorderThickness="3"
                    CornerRadius="10"
                    Width="700"
                    MaxHeight="500"
                    Padding="30"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                
                <StackPanel Spacing="20">
                    <!-- Nombre de la facción -->
                    <TextBlock Text="{Binding SelectedFaction.Name}"
                             FontSize="32"
                             FontWeight="Bold"
                             Foreground="{Binding SelectedFaction.ThemeColor}"
                             HorizontalAlignment="Center"/>
                    
                    <!-- Líder -->
                    <TextBlock FontSize="14"
                             Foreground="#AAAAAA"
                             HorizontalAlignment="Center">
                        <Run Text="Líder: "/>
                        <Run Text="{Binding SelectedFaction.Leader}" FontWeight="Bold"/>
                    </TextBlock>
                    
                    <!-- Descripción -->
                    <Border Background="#0f3460"
                           BorderBrush="{Binding SelectedFaction.ThemeColor}"
                           BorderThickness="1"
                           CornerRadius="5"
                           Padding="20"
                           MaxHeight="250">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <TextBlock Text="{Binding SelectedFaction.Description}"
                                     FontSize="14"
                                     Foreground="White"
                                     TextWrapping="Wrap"
                                     LineHeight="22"/>
                        </ScrollViewer>
                    </Border>
                    
                    <!-- Botones -->
                    <StackPanel Orientation="Horizontal"
                               Spacing="15"
                               HorizontalAlignment="Center"
                               Margin="0,10,0,0">
                        <Button Content="✓ Confirmar Selección"
                               Command="{Binding ConfirmFactionCommand}"
                               Background="{Binding SelectedFaction.ThemeColor}"
                               Foreground="#000000"
                               Width="220"
                               Height="50"
                               FontWeight="Bold"
                               FontSize="14"
                               CornerRadius="5"/>
                        
                        <Button Content="← Volver a elegir"
                               Command="{Binding CancelSelectionCommand}"
                               Background="#AA0000"
                               Foreground="White"
                               Width="180"
                               Height="50"
                               FontWeight="Bold"
                               FontSize="14"
                               CornerRadius="5"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>